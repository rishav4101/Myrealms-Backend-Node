"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const { check, validationResult } = require("express-validator");
const artPost = require("../models/artPost");
const artRouter = express_1.default.Router();
var fs = require('fs');
const auth = require('../middlewares/auth');
const Users = require('../models/user');
artRouter.route('/')
    .get(auth.required, async (req, res, next) => {
    try {
        await artPost.find({})
            .then((arts) => {
            res.statusCode = 200;
            res.setHeader('Content-Type', 'application/json');
            res.json(arts);
        })
            .catch((err) => {
            next(err);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .post(auth.required, async (req, res, next) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
        return res.status(400).json({ errors: errors.array() });
    }
    try {
        const newPost = new artPost({
            user: req.payload.id,
            description: req.body.description,
            title: req.body.title,
            time: Date.now(),
            img: req.body.img,
        });
        const post = await newPost.save();
        res.json(post);
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
artRouter.route('/:id')
    .get(auth.required, async (req, res, next) => {
    try {
        await artPost.findById(req.params.id)
            .then((art) => {
            res.statusCode = 200;
            res.setHeader('Content-Type', 'application/json');
            res.json(art);
        })
            .catch((err) => {
            next(err);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .delete(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            if (art.user == tuser.id) {
                await art.remove();
                res.json({ msg: "Post Removed" });
            }
            else {
                res.json({ msg: "You cannot remove this post" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            if (art.user == tuser.id) {
                await artPost.findByIdAndUpdate(req.params.id, req.body, { useFindAndModify: false });
                res.json({ msg: "Post Updated" });
            }
            else {
                res.json({ msg: "You cannot update this post" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
artRouter.route('/like/:id')
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            if (art.likes.filter((like) => like.user.toString() === req.payload.id).length > 0) {
                return res.status(400).json({ msg: "Post already liked" });
            }
            else {
                art.likes.unshift({ user: req.payload.id });
                await (art === null || art === void 0 ? void 0 : art.save());
                res.json({ msg: "post liked" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
artRouter.route('/unlike/:id')
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            if (art.likes.filter((like) => like.user.toString() === req.payload.id).length === 0) {
                return res.status(400).json({ msg: "Post has not yet been liked" });
            }
            else {
                const removeIndex = art.likes
                    .map((like) => like.user.toString())
                    .indexOf(req.payload.id);
                art === null || art === void 0 ? void 0 : art.likes.splice(removeIndex, 1);
                await (art === null || art === void 0 ? void 0 : art.save());
                res.json({ msg: "post unliked" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
artRouter.route('/comment/:id')
    .post(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            const newComment = {
                time: Date.now(),
                text: req.body.text,
                name: tuser === null || tuser === void 0 ? void 0 : tuser.username,
                user: req.payload.id,
            };
            art === null || art === void 0 ? void 0 : art.comments.unshift(newComment);
            await art.save();
            res.json(art.comments);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
artRouter.route('/comment/:id/:comment_id')
    .delete(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await artPost.findById(req.params.id)
            .then(async (art) => {
            const comment = art === null || art === void 0 ? void 0 : art.comments.find((comment) => comment.id === req.params.comment_id);
            if (!comment) {
                return res.sendStatus(404);
            }
            if (comment.user.toString() !== req.payload.id) {
                return res.sendStatus(401);
            }
            art.comments = art.comments.filter(({ id }) => id !== req.params.comment_id);
            await art.save();
            return res.json({ msg: "comment deleted" });
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
module.exports = artRouter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJ0Um91dGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JvdXRlcy9hcnRSb3V0ZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxzREFBOEI7QUFFOUIsTUFBTSxFQUFFLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBRWpFLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQzdDLE1BQU0sU0FBUyxHQUFHLGlCQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFbkMsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBS3ZCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBZXhDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0tBRW5CLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO0lBQ3pDLElBQUk7UUFDSixNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2FBQ3JCLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ1gsR0FBRyxDQUFDLFVBQVUsR0FBQyxHQUFHLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNqRCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25CLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ1gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUE7S0FDRDtJQUFDLE9BQU0sR0FBRyxFQUFF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QUMsQ0FBQzthQUM5QjtZQUVELElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRTtnQkFDNUMsT0FBTyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzlCO1lBRUQsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FFOUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQzNDLENBQUM7WUFFRixNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUVqQixPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUMsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFBO0tBQ0w7SUFBQyxPQUFNLEdBQUcsRUFBRTtRQUNULE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDdkI7QUFDTCxDQUFDLENBQUMsQ0FBQTtBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuLy9AdHMtaWdub3JlXHJcbmNvbnN0IHsgY2hlY2ssIHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoXCJleHByZXNzLXZhbGlkYXRvclwiKTtcclxuXHJcbmNvbnN0IGFydFBvc3QgPSByZXF1aXJlKFwiLi4vbW9kZWxzL2FydFBvc3RcIik7XHJcbmNvbnN0IGFydFJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbi8vQHRzLWlnbm9yZVxyXG52YXIgZnMgPSByZXF1aXJlKCdmcycpOyBcclxuLy9AdHMtaWdub3JlXHJcbi8vIHZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpOyBcclxuLy8gdmFyIG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpOyBcclxuXHJcbmNvbnN0IGF1dGggPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlcy9hdXRoJyk7XHJcbmNvbnN0IFVzZXJzID0gcmVxdWlyZSgnLi4vbW9kZWxzL3VzZXInKTtcclxuXHJcbi8vIHZhciBzdG9yYWdlID0gbXVsdGVyLmRpc2tTdG9yYWdlKHsgXHJcbi8vICAgICAvL0B0cy1pZ25vcmVcclxuLy8gXHRkZXN0aW5hdGlvbjogKHJlcSwgZmlsZSwgY2IpID0+IHsgXHJcbi8vIFx0XHRjYihudWxsLCAndXBsb2FkcycpXHJcbi8vICAgICB9LCBcclxuLy8gICAgIC8vQHRzLWlnbm9yZVxyXG4vLyBcdGZpbGVuYW1lOiAocmVxLCBmaWxlLCBjYikgPT4geyBcclxuLy8gXHRcdGNiKG51bGwsIGZpbGUuZmllbGRuYW1lICsgJy0nICsgRGF0ZS5ub3coKSArIHBhdGguZXh0bmFtZShmaWxlLm9yaWdpbmFsbmFtZSkpIFxyXG4vLyBcdH0gXHJcbi8vIH0pOyBcclxuLy8gLy9AdHMtaWdub3JlXHJcbi8vIHZhciB1cGxvYWQgPSBtdWx0ZXIoeyBzdG9yYWdlOiBzdG9yYWdlIH0pOyBcclxuXHJcbmFydFJvdXRlci5yb3V0ZSgnLycpXHJcbi8vQHRzLWlnbm9yZVxyXG4uZ2V0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHsgXHJcbiAgICBhd2FpdCBhcnRQb3N0LmZpbmQoe30pXHJcbiAgICAudGhlbigoYXJ0cykgPT4ge1xyXG4gICAgICAgIHJlcy5zdGF0dXNDb2RlPTIwMDtcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgICAgICAgcmVzLmpzb24oYXJ0cyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBuZXh0KGVycik7XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG4vL0B0cy1pZ25vcmVcclxuLnBvc3QoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XHJcbiAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3JzOiBlcnJvcnMuYXJyYXkoKSB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcS5ib2R5KVxyXG4gICAgICAgIGNvbnN0IG5ld1Bvc3QgPSBuZXcgYXJ0UG9zdCh7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB1c2VyOiByZXEucGF5bG9hZC5pZCxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlcS5ib2R5LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICB0aXRsZTogcmVxLmJvZHkudGl0bGUsXHJcbiAgICAgICAgICAgIHRpbWU6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgIGltZzogcmVxLmJvZHkuaW1nLFxyXG4gICAgICAgICAgICAvLyBpbWc6IHsgXHJcbiAgICAgICAgICAgIC8vICAgICBkYXRhOiBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKCcvdXBsb2Fkcy8nICsgcmVxLmJvZHkuaW1nKSksIFxyXG4gICAgICAgICAgICAvLyAgICAgY29udGVudFR5cGU6ICdpbWFnZS9wbmcnIHx8ICdpbWFnZS9qcGVnJ1xyXG4gICAgICAgICAgICAvLyB9IFxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGNvbnN0IHBvc3QgPSBhd2FpdCBuZXdQb3N0LnNhdmUoKTtcclxuICAgICAgICByZXMuanNvbihwb3N0KTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9XHJcbn0pXHJcblxyXG5hcnRSb3V0ZXIucm91dGUoJy86aWQnKVxyXG4vL0B0cy1pZ25vcmVcclxuLmdldChhdXRoLnJlcXVpcmVkLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7IFxyXG4gICAgYXdhaXQgYXJ0UG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgLnRoZW4oKGFydCkgPT4ge1xyXG4gICAgICAgIHJlcy5zdGF0dXNDb2RlPTIwMDtcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgICAgICAgcmVzLmpzb24oYXJ0KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIG5leHQoZXJyKTtcclxuICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9XHJcbn0pXHJcbi8vQHRzLWlnbm9yZVxyXG4uZGVsZXRlKGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgY29uc3QgdHVzZXIgPSBhd2FpdCBVc2Vycy5maW5kQnlJZChyZXEucGF5bG9hZC5pZClcclxuICAgIGF3YWl0IGFydFBvc3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZClcclxuICAgIC50aGVuKGFzeW5jIChhcnQpID0+IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBpZihhcnQudXNlciA9PSB0dXNlci5pZCl7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBhd2FpdCBhcnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbXNnOiBcIlBvc3QgUmVtb3ZlZFwiIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICByZXMuanNvbih7IG1zZzogXCJZb3UgY2Fubm90IHJlbW92ZSB0aGlzIHBvc3RcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG4vL0B0cy1pZ25vcmVcclxuLnB1dChhdXRoLnJlcXVpcmVkLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIGNvbnN0IHR1c2VyID0gYXdhaXQgVXNlcnMuZmluZEJ5SWQocmVxLnBheWxvYWQuaWQpXHJcbiAgICBhd2FpdCBhcnRQb3N0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIC50aGVuKGFzeW5jIChhcnQpID0+IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBpZihhcnQudXNlciA9PSB0dXNlci5pZCkge1xyXG4gICAgICAgICAgICBhd2FpdCBhcnRQb3N0LmZpbmRCeUlkQW5kVXBkYXRlKHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5LCB7dXNlRmluZEFuZE1vZGlmeTpmYWxzZX0pXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1zZzogXCJQb3N0IFVwZGF0ZWRcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1zZzogXCJZb3UgY2Fubm90IHVwZGF0ZSB0aGlzIHBvc3RcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG5cclxuYXJ0Um91dGVyLnJvdXRlKCcvbGlrZS86aWQnKVxyXG4vL0B0cy1pZ25vcmVcclxuLnB1dChhdXRoLnJlcXVpcmVkLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgY29uc3QgdHVzZXIgPSBhd2FpdCBVc2Vycy5maW5kQnlJZChyZXEucGF5bG9hZC5pZClcclxuICAgICAgICBhd2FpdCBhcnRQb3N0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgLnRoZW4oYXN5bmMgKGFydCkgPT4ge1xyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgaWYgKGFydC5saWtlcy5maWx0ZXIoKGxpa2UpID0+IGxpa2UudXNlci50b1N0cmluZygpID09PSByZXEucGF5bG9hZC5pZCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbXNnOiBcIlBvc3QgYWxyZWFkeSBsaWtlZFwiIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICBhcnQubGlrZXMudW5zaGlmdCh7IHVzZXI6IHJlcS5wYXlsb2FkLmlkIH0pO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgYXJ0Py5zYXZlKClcclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHttc2c6IFwicG9zdCBsaWtlZFwifSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9IFxyXG59KVxyXG5cclxuYXJ0Um91dGVyLnJvdXRlKCcvdW5saWtlLzppZCcpXHJcbi8vQHRzLWlnbm9yZVxyXG4ucHV0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCB0dXNlciA9IGF3YWl0IFVzZXJzLmZpbmRCeUlkKHJlcS5wYXlsb2FkLmlkKVxyXG4gICAgICAgIGF3YWl0IGFydFBvc3QuZmluZEJ5SWQocmVxLnBhcmFtcy5pZClcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAudGhlbihhc3luYyAoYXJ0KSA9PiB7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBpZiAoYXJ0Lmxpa2VzLmZpbHRlcigobGlrZSkgPT4gbGlrZS51c2VyLnRvU3RyaW5nKCkgPT09IHJlcS5wYXlsb2FkLmlkKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1zZzogXCJQb3N0IGhhcyBub3QgeWV0IGJlZW4gbGlrZWRcIiB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgIC8vR2V0IHJlbW92ZSBpbmRleFxyXG4gICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgIGNvbnN0IHJlbW92ZUluZGV4ID0gYXJ0Lmxpa2VzXHJcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIC5tYXAoKGxpa2UpID0+IGxpa2UudXNlci50b1N0cmluZygpKVxyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAuaW5kZXhPZihyZXEucGF5bG9hZC5pZCk7XHJcblxyXG4gICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgIGFydD8ubGlrZXMuc3BsaWNlKHJlbW92ZUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICBhd2FpdCBhcnQ/LnNhdmUoKTtcclxuICAgICAgICAgICAgICByZXMuanNvbih7bXNnOiBcInBvc3QgdW5saWtlZFwifSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9IFxyXG59KVxyXG5cclxuYXJ0Um91dGVyLnJvdXRlKCcvY29tbWVudC86aWQnKVxyXG4vL0B0cy1pZ25vcmVcclxuLnBvc3QoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IHR1c2VyID0gYXdhaXQgVXNlcnMuZmluZEJ5SWQocmVxLnBheWxvYWQuaWQpXHJcbiAgICAgICAgYXdhaXQgYXJ0UG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIC50aGVuKGFzeW5jIChhcnQpID0+IHtcclxuICAgICAgICBjb25zdCBuZXdDb21tZW50ID0ge1xyXG4gICAgICAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxyXG4gICAgICAgICAgICB0ZXh0OiByZXEuYm9keS50ZXh0LFxyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgbmFtZTogdHVzZXI/LnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgdXNlcjogcmVxLnBheWxvYWQuaWQsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICBhcnQ/LmNvbW1lbnRzLnVuc2hpZnQobmV3Q29tbWVudCk7XHJcbiAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgIGF3YWl0IGFydC5zYXZlKCk7XHJcbiAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgIHJlcy5qc29uKGFydC5jb21tZW50cyk7XHJcbiAgICAgICAgfSlcclxuICAgIH0gY2F0Y2goZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKTtcclxuICAgIH1cclxufSlcclxuXHJcbmFydFJvdXRlci5yb3V0ZSgnL2NvbW1lbnQvOmlkLzpjb21tZW50X2lkJylcclxuLy9AdHMtaWdub3JlXHJcbi5kZWxldGUoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IHR1c2VyID0gYXdhaXQgVXNlcnMuZmluZEJ5SWQocmVxLnBheWxvYWQuaWQpXHJcbiAgICAgICAgYXdhaXQgYXJ0UG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIC50aGVuKGFzeW5jIChhcnQpID0+IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCBjb21tZW50ID0gYXJ0Py5jb21tZW50cy5maW5kKFxyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgKGNvbW1lbnQpID0+IGNvbW1lbnQuaWQgPT09IHJlcS5wYXJhbXMuY29tbWVudF9pZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgLy8gTWFrZSBzdXJlIGNvbW1lbnQgZXhpc3RzXHJcbiAgICAgICAgaWYgKCFjb21tZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBpZiAoY29tbWVudC51c2VyLnRvU3RyaW5nKCkgIT09IHJlcS5wYXlsb2FkLmlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBhcnQuY29tbWVudHMgPSBhcnQuY29tbWVudHMuZmlsdGVyKFxyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgKHsgaWQgfSkgPT4gaWQgIT09IHJlcS5wYXJhbXMuY29tbWVudF9pZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgYXdhaXQgYXJ0LnNhdmUoKTtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oe21zZzpcImNvbW1lbnQgZGVsZXRlZFwifSk7XHJcbiAgICAgICAgfSlcclxuICAgIH0gY2F0Y2goZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKTtcclxuICAgIH1cclxufSlcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gYXJ0Um91dGVyOyJdfQ==