"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const { check, validationResult } = require("express-validator");
const clickPost = require("../models/clickPost");
const clickRouter = express_1.default.Router();
const auth = require('../middlewares/auth');
const Users = require('../models/user');
clickRouter.route('/')
    .get(auth.required, async (req, res, next) => {
    try {
        await clickPost.find({})
            .then((clicks) => {
            res.statusCode = 200;
            res.setHeader('Content-Type', 'application/json');
            res.json(clicks);
        })
            .catch((err) => {
            next(err);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .post(auth.required, async (req, res, next) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
        return res.status(400).json({ errors: errors.array() });
    }
    try {
        const newPost = new clickPost({
            user: req.payload.id,
            description: req.body.description,
            title: req.body.title,
            img: req.body.img,
            time: Date.now(),
        });
        const post = await newPost.save();
        res.json(post);
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
clickRouter.route('/:id')
    .get(auth.required, async (req, res, next) => {
    try {
        await clickPost.findById(req.params.id)
            .then((click) => {
            res.statusCode = 200;
            res.setHeader('Content-Type', 'application/json');
            res.json(click);
        })
            .catch((err) => {
            next(err);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .delete(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            if (click.user == tuser.id) {
                await click.remove();
                res.json({ msg: "Post Removed" });
            }
            else {
                res.json({ msg: "You cannot remove this post" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
})
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            if (click.user == tuser.id) {
                await clickPost.findByIdAndUpdate(req.params.id, req.body, { useFindAndModify: false });
                res.json({ msg: "Post Updated" });
            }
            else {
                res.json({ msg: "You cannot update this post" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
clickRouter.route('/like/:id')
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            if (click.likes.filter((like) => like.user.toString() === req.payload.id).length > 0) {
                return res.status(400).json({ msg: "Post already liked" });
            }
            else {
                click.likes.unshift({ user: req.payload.id });
                await (click === null || click === void 0 ? void 0 : click.save());
                res.json({ msg: "post liked" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
clickRouter.route('/unlike/:id')
    .put(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            if (click.likes.filter((like) => like.user.toString() === req.payload.id).length === 0) {
                return res.status(400).json({ msg: "Post has not yet been liked" });
            }
            else {
                const removeIndex = click.likes
                    .map((like) => like.user.toString())
                    .indexOf(req.payload.id);
                click === null || click === void 0 ? void 0 : click.likes.splice(removeIndex, 1);
                await (click === null || click === void 0 ? void 0 : click.save());
                res.json({ msg: "post unliked" });
            }
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
clickRouter.route('/comment/:id')
    .post(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            const newComment = {
                time: Date.now(),
                text: req.body.text,
                name: tuser === null || tuser === void 0 ? void 0 : tuser.username,
                user: req.payload.id,
            };
            click === null || click === void 0 ? void 0 : click.comments.unshift(newComment);
            await click.save();
            res.json(click.comments);
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
clickRouter.route('/comment/:id/:comment_id')
    .delete(auth.required, async (req, res, next) => {
    try {
        const tuser = await Users.findById(req.payload.id);
        await clickPost.findById(req.params.id)
            .then(async (click) => {
            const comment = click === null || click === void 0 ? void 0 : click.comments.find((comment) => comment.id === req.params.comment_id);
            if (!comment) {
                return res.sendStatus(404);
            }
            if (comment.user.toString() !== req.payload.id) {
                return res.sendStatus(401);
            }
            click.comments = click.comments.filter(({ id }) => id !== req.params.comment_id);
            await click.save();
            return res.json({ msg: "comment deleted" });
        });
    }
    catch (err) {
        console.error(err.message);
        res.sendStatus(500);
    }
});
module.exports = clickRouter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpY2tSb3V0ZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcm91dGVzL2NsaWNrUm91dGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsc0RBQThCO0FBRTlCLE1BQU0sRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUVqRSxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNqRCxNQUFNLFdBQVcsR0FBRyxpQkFBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRXJDLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBRXhDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0tBRXJCLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO0lBQ3pDLElBQUk7UUFDSixNQUFNLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2FBQ3ZCLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ2IsR0FBRyxDQUFDLFVBQVUsR0FBQyxHQUFHLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNqRCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JCLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ1gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUE7S0FDRDtJQUFDLE9BQU0sR0FBRyxFQUFFO1FBQ1QsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxD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QyxRQUFRLEVBQUUsS0FBSyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRTtnQkFDNUMsT0FBTyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzlCO1lBRUQsS0FBSyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FFbEMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQzNDLENBQUM7WUFFRixNQUFNLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUVuQixPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUMsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFBO0tBQ0w7SUFBQyxPQUFNLEdBQUcsRUFBRTtRQUNULE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDdkI7QUFDTCxDQUFDLENBQUMsQ0FBQTtBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsV0FBVyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuLy9AdHMtaWdub3JlXHJcbmNvbnN0IHsgY2hlY2ssIHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoXCJleHByZXNzLXZhbGlkYXRvclwiKTtcclxuXHJcbmNvbnN0IGNsaWNrUG9zdCA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvY2xpY2tQb3N0XCIpO1xyXG5jb25zdCBjbGlja1JvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcblxyXG5jb25zdCBhdXRoID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZXMvYXV0aCcpO1xyXG5jb25zdCBVc2VycyA9IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7XHJcblxyXG5jbGlja1JvdXRlci5yb3V0ZSgnLycpXHJcbi8vQHRzLWlnbm9yZVxyXG4uZ2V0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHsgXHJcbiAgICBhd2FpdCBjbGlja1Bvc3QuZmluZCh7fSlcclxuICAgIC50aGVuKChjbGlja3MpID0+IHtcclxuICAgICAgICByZXMuc3RhdHVzQ29kZT0yMDA7XHJcbiAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICAgIHJlcy5qc29uKGNsaWNrcyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBuZXh0KGVycik7XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG4vL0B0cy1pZ25vcmVcclxuLnBvc3QoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XHJcbiAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3JzOiBlcnJvcnMuYXJyYXkoKSB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2Vycy5maW5kQnlJZChyZXEuYm9keS51c2VyKVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcSk7XHJcbiAgICAgICAgY29uc3QgbmV3UG9zdCA9IG5ldyBjbGlja1Bvc3Qoe1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS5wYXlsb2FkLmlkLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIHRpdGxlOiByZXEuYm9keS50aXRsZSxcclxuICAgICAgICAgICAgaW1nOiByZXEuYm9keS5pbWcsXHJcbiAgICAgICAgICAgIHRpbWU6IERhdGUubm93KCksXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgY29uc3QgcG9zdCA9IGF3YWl0IG5ld1Bvc3Quc2F2ZSgpO1xyXG4gICAgICAgIHJlcy5qc29uKHBvc3QpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKTtcclxuICAgIH1cclxufSlcclxuXHJcbmNsaWNrUm91dGVyLnJvdXRlKCcvOmlkJylcclxuLy9AdHMtaWdub3JlXHJcbi5nZXQoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICB0cnkgeyBcclxuICAgIGF3YWl0IGNsaWNrUG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgLnRoZW4oKGNsaWNrKSA9PiB7XHJcbiAgICAgICAgcmVzLnN0YXR1c0NvZGU9MjAwO1xyXG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgICAgICByZXMuanNvbihjbGljayk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBuZXh0KGVycik7XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG4vL0B0cy1pZ25vcmVcclxuLmRlbGV0ZShhdXRoLnJlcXVpcmVkLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIGNvbnN0IHR1c2VyID0gYXdhaXQgVXNlcnMuZmluZEJ5SWQocmVxLnBheWxvYWQuaWQpXHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIGF3YWl0IGNsaWNrUG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgLnRoZW4oYXN5bmMgKGNsaWNrKSA9PiB7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgaWYoY2xpY2sudXNlciA9PSB0dXNlci5pZCl7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBhd2FpdCBjbGljay5yZW1vdmUoKTtcclxuICAgICAgICAgICAgcmVzLmpzb24oeyBtc2c6IFwiUG9zdCBSZW1vdmVkXCIgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbXNnOiBcIllvdSBjYW5ub3QgcmVtb3ZlIHRoaXMgcG9zdFwiIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9XHJcbn0pXHJcbi8vQHRzLWlnbm9yZVxyXG4ucHV0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgY29uc3QgdHVzZXIgPSBhd2FpdCBVc2Vycy5maW5kQnlJZChyZXEucGF5bG9hZC5pZClcclxuICAgIFxyXG4gICAgYXdhaXQgY2xpY2tQb3N0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIC50aGVuKGFzeW5jIChjbGljaykgPT4ge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGlmKGNsaWNrLnVzZXIgPT0gdHVzZXIuaWQpIHtcclxuICAgICAgICAgICAgYXdhaXQgY2xpY2tQb3N0LmZpbmRCeUlkQW5kVXBkYXRlKHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5LCB7dXNlRmluZEFuZE1vZGlmeTpmYWxzZX0pXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1zZzogXCJQb3N0IFVwZGF0ZWRcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICByZXMuanNvbih7IG1zZzogXCJZb3UgY2Fubm90IHVwZGF0ZSB0aGlzIHBvc3RcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG5cclxuY2xpY2tSb3V0ZXIucm91dGUoJy9saWtlLzppZCcpXHJcbi8vQHRzLWlnbm9yZVxyXG4ucHV0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCB0dXNlciA9IGF3YWl0IFVzZXJzLmZpbmRCeUlkKHJlcS5wYXlsb2FkLmlkKVxyXG4gICAgICAgIGF3YWl0IGNsaWNrUG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIC50aGVuKGFzeW5jIChjbGljaykgPT4ge1xyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgaWYgKGNsaWNrLmxpa2VzLmZpbHRlcigobGlrZSkgPT4gbGlrZS51c2VyLnRvU3RyaW5nKCkgPT09IHJlcS5wYXlsb2FkLmlkKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtc2c6IFwiUG9zdCBhbHJlYWR5IGxpa2VkXCIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIGNsaWNrLmxpa2VzLnVuc2hpZnQoeyB1c2VyOiByZXEucGF5bG9hZC5pZCB9KTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGNsaWNrPy5zYXZlKClcclxuICAgICAgICAgICAgICAgIHJlcy5qc29uKHttc2c6IFwicG9zdCBsaWtlZFwifSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9IFxyXG59KVxyXG5cclxuY2xpY2tSb3V0ZXIucm91dGUoJy91bmxpa2UvOmlkJylcclxuLy9AdHMtaWdub3JlXHJcbi5wdXQoYXV0aC5yZXF1aXJlZCwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IHR1c2VyID0gYXdhaXQgVXNlcnMuZmluZEJ5SWQocmVxLnBheWxvYWQuaWQpXHJcbiAgICAgICAgYXdhaXQgY2xpY2tQb3N0LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgLnRoZW4oYXN5bmMgKGNsaWNrKSA9PiB7XHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBpZiAoY2xpY2subGlrZXMuZmlsdGVyKChsaWtlKSA9PiBsaWtlLnVzZXIudG9TdHJpbmcoKSA9PT0gcmVxLnBheWxvYWQuaWQpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbXNnOiBcIlBvc3QgaGFzIG5vdCB5ZXQgYmVlbiBsaWtlZFwiIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgLy9HZXQgcmVtb3ZlIGluZGV4XHJcbiAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlSW5kZXggPSBjbGljay5saWtlc1xyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAubWFwKChsaWtlKSA9PiBsaWtlLnVzZXIudG9TdHJpbmcoKSlcclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgLmluZGV4T2YocmVxLnBheWxvYWQuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICBjbGljaz8ubGlrZXMuc3BsaWNlKHJlbW92ZUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICBhd2FpdCBjbGljaz8uc2F2ZSgpO1xyXG4gICAgICAgICAgICAgIHJlcy5qc29uKHttc2c6IFwicG9zdCB1bmxpa2VkXCJ9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0gY2F0Y2goZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKTtcclxuICAgIH0gXHJcbn0pXHJcblxyXG5jbGlja1JvdXRlci5yb3V0ZSgnL2NvbW1lbnQvOmlkJylcclxuLy9AdHMtaWdub3JlXHJcbi5wb3N0KGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCB0dXNlciA9IGF3YWl0IFVzZXJzLmZpbmRCeUlkKHJlcS5wYXlsb2FkLmlkKVxyXG4gICAgICAgIGF3YWl0IGNsaWNrUG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIC50aGVuKGFzeW5jIChjbGljaykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0NvbW1lbnQgPSB7XHJcbiAgICAgICAgICAgIHRpbWU6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgIHRleHQ6IHJlcS5ib2R5LnRleHQsXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBuYW1lOiB0dXNlcj8udXNlcm5hbWUsXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB1c2VyOiByZXEucGF5bG9hZC5pZCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgIGNsaWNrPy5jb21tZW50cy51bnNoaWZ0KG5ld0NvbW1lbnQpO1xyXG4gICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICBhd2FpdCBjbGljay5zYXZlKCk7XHJcbiAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgIHJlcy5qc29uKGNsaWNrLmNvbW1lbnRzKTtcclxuICAgICAgICB9KVxyXG4gICAgfSBjYXRjaChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApO1xyXG4gICAgfVxyXG59KVxyXG5cclxuY2xpY2tSb3V0ZXIucm91dGUoJy9jb21tZW50LzppZC86Y29tbWVudF9pZCcpXHJcbi8vQHRzLWlnbm9yZVxyXG4uZGVsZXRlKGF1dGgucmVxdWlyZWQsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCB0dXNlciA9IGF3YWl0IFVzZXJzLmZpbmRCeUlkKHJlcS5wYXlsb2FkLmlkKVxyXG4gICAgICAgIGF3YWl0IGNsaWNrUG9zdC5maW5kQnlJZChyZXEucGFyYW1zLmlkKVxyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIC50aGVuKGFzeW5jIChjbGljaykgPT4ge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IGNvbW1lbnQgPSBjbGljaz8uY29tbWVudHMuZmluZChcclxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgIChjb21tZW50KSA9PiBjb21tZW50LmlkID09PSByZXEucGFyYW1zLmNvbW1lbnRfaWRcclxuICAgICAgICApO1xyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSBjb21tZW50IGV4aXN0c1xyXG4gICAgICAgIGlmICghY29tbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDA0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgaWYgKGNvbW1lbnQudXNlci50b1N0cmluZygpICE9PSByZXEucGF5bG9hZC5pZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgY2xpY2suY29tbWVudHMgPSBjbGljay5jb21tZW50cy5maWx0ZXIoXHJcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAoeyBpZCB9KSA9PiBpZCAhPT0gcmVxLnBhcmFtcy5jb21tZW50X2lkXHJcbiAgICAgICAgKTtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBhd2FpdCBjbGljay5zYXZlKCk7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHttc2c6XCJjb21tZW50IGRlbGV0ZWRcIn0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMCk7XHJcbiAgICB9XHJcbn0pXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGNsaWNrUm91dGVyOyJdfQ==